import React from 'react';
import type { Scene } from '../types';

interface SceneSelectorProps {
  scenes: Scene[];
  activeIndex: number;
  onSceneSelect: (index: number) => void;
  onSceneCopy: (index: number) => void;
  onScenePaste: (index: number) => void;
  onSceneClear: (index: number) => void;
  onRandomizeActive: () => void;
  onImport: () => void;
  onExport: () => void;
  onExportAll: () => void;
}

export const SceneSelector: React.FC<SceneSelectorProps> = ({
  scenes,
  activeIndex,
  onSceneSelect,
  onSceneCopy,
  onScenePaste,
  onSceneClear,
  onRandomizeActive,
  onImport,
  onExport,
  onExportAll,
}) => {
  const sceneLabels = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
  
  const hasData = (scene: Scene): boolean => {
    // Check if scene has any active steps
    return Object.values(scene.grid).some(pattern => pattern.some(step => step));
  };

  const handleContextMenu = (e: React.MouseEvent, index: number) => {
    e.preventDefault();
    // For now, just show a simple context menu using browser prompt
    const action = window.prompt(
      `Scene ${sceneLabels[index]} Actions:\n1 - Copy\n2 - Paste\n3 - Clear\n\nEnter number:`,
      '1'
    );
    
    if (action === '1') onSceneCopy(index);
    else if (action === '2') onScenePaste(index);
    else if (action === '3') {
      if (window.confirm(`Clear Scene ${sceneLabels[index]}?`)) {
        onSceneClear(index);
      }
    }
  };

  return (
    <div className="scene-selector">
      <div className="scene-selector-top">
        <div className="scene-label">SCENES</div>
        <div className="scene-global-actions">
          <button className="scene-action-btn" onClick={() => onSceneClear(activeIndex)} title="Clear Active Scene">
            Clear
          </button>
          <button className="scene-action-btn" onClick={onRandomizeActive} title="Randomize Active Scene">
            Random
          </button>
          <div className="scene-divider" />
          <button className="scene-action-btn" onClick={onImport} title="Import Scene (.json)">
            Import
          </button>
          <button className="scene-action-btn" onClick={onExport} title="Export Scene (.json)">
            Export
          </button>
          <button className="scene-action-btn" onClick={onExportAll} title="Export All Scenes (.json)">
            Export All
          </button>
        </div>
      </div>
      <div className="scene-buttons">
        {sceneLabels.map((label, index) => (
          <button
            key={label}
            className={`scene-btn ${activeIndex === index ? 'active' : ''} ${hasData(scenes[index]) ? 'has-data' : ''}`}
            onClick={() => onSceneSelect(index)}
            onContextMenu={(e) => handleContextMenu(e, index)}
            title={`Scene ${label}${hasData(scenes[index]) ? ' (has data)' : ''}\nRight-click for options`}
          >
            <span className="scene-btn-label">{label}</span>
            {hasData(scenes[index]) && <span className="scene-indicator">â€¢</span>}
          </button>
        ))}
      </div>
    </div>
  );
};
